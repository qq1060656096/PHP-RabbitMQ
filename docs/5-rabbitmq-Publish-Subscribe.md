# 发布/订阅

>发送一条消息,多个消费者处理

在前面的教程中,我们创建了一个工作队列。工作队列背后的假设是,每个任务是交付给一个工人。在本部分,我们将做一些完全不同的事情,我们会提供一个消息到多个消费者。这种模式被称为“发布/订阅”。

为了说明这个模式,我们将构建一个简单的日志系统。它将包括两个项目,第一个将发出日志消息,第二个将接收并打印它们。

在我们的日志系统每运行接收者项目将得到消息的副本。这样我们能够运行一个接收器和直接记录到磁盘,同时我们可以运行另一个接收器,看到屏幕上的日志。

本质上,发表日志消息将被广播给所有的接收器。

### 交换器
在前面的部分教程中我们与队列发送和接收消息。现在是时候在Rabbit介绍完整的消息传递模型。

> 让我们快速回顾我们在前面的教程:
> 1. 生产者(producer)是一个用户应用程序发送消息。
> 2. 队列是一个缓冲区,它存储信息。
> 3. 消费者(consumer)是一个用户应用程序接收消息。

RabbitMQ的消息模型的核心思想是,生产者没有直接向队列发送任何消息。实际上,经常生产者甚至不知道一个消息将传递给任何队列。

Producer发送的Message实际上是发到了Exchange中。它的功能也很简单：从Producer接收Message，然后投递到queue中。Exchange需要知道如何处理Message，是把Message放到特定queue中，还是放到多个queue中？或者丢弃.这个rule是通过Exchange 的type定义的。

![avatar](data:image/png;base64,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)

有一些可用的交换类型: "direct", "topic", "headers"和"fanout"。我们将关注最后一个——"fanout"。让我们创建一个该类型的交换,称之为logs

```php
channel.exchange_declare(exchange='logs', type='fanout')
```

fanout exchange非常简单。您可能会猜测的名字,fanout就是广播模式,广播所有的消息到它知道所有队列。而这正是我们需要为我们的logger。

> ### exchange列表
> 列出服务器上的交流有用rabbitmqctl您可以运行:

```php
sudo rabbitmqctl list_exchanges
```

这个列表中会有一些amq。*交流与默认(匿名)交换。这些都是默认创建,但不太可能你需要使用它们。

### 默认交换器
在前面的部分教程中我们一无所知交往,但仍然能够将消息发送到队列。这是可能的因为我们是使用一个默认的交换,我们确定的空字符串(" ")。
记得之前我们发布一个消息:

```php
channel.basic_publish(exchange='', routing_key='hello', body=message)
```

> exchange参数是交换器的名称。空字符串表示默认或无名的交换:消息路由到指定的队列的名称routing_key,如果它存在。

现在,我们可以发表我们命名为交换而不是:

```php
channel.basic_publish(exchange='logs', routing_key='', body=message)
```

### 临时队列

你可能还记得以前我们使用队列有一个指定的名称(还记得hello和task_queue吗?)。能够说出一个队列是至关重要的,我们需要点工人相同的队列。给一个队列的名字是很重要的,当你想在生产者和消费者之间共享队列。

但这并不是我们的记录器。我们想要听到的所有日志消息,不仅仅是其中的一个子集。我们也只对当前交换器感兴趣而不是旧的消息。解决,我们需要两件事情。

首先,每当我们连接到Rabbit我们需要一个新鲜的、空的队列。去做我们可以创建一个队列和一个随机的名字,或者,甚至更好,让服务器选择一个随机队列名称。我们不可以通过提供queue_declare队列参数:

```php
result = channel.queue_declare()
```

在这一点上result.method。队列包含随机队列名称。例如它可能看起来像amq.gen-JzTY20BRgKO-HjmUJj0wLg。

其次,一旦我们消费者应该删除队列断开。有一个专属标志:

```php 
result = channel.queue_declare(exclusive=True)
```

# 捆绑

![avatar](data:image/png;base64,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)

我们已经创建了一个展开交流和一个队列。现在我们需要告诉交换将消息发送到队列。交易所之间的关系和一个队列称为绑定。

```php
channel.queue_bind(exchange='logs', queue=result.method.queue)
```

从现在起日志交易所将附加消息队列。


> ### 绑定列表
> 你能列出现有的绑定使用,你猜对了.

```php
rabbitmqctl list_bindings
```

### 把它放在一起

![avatar](data:image/png;base64,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)

生产者程序发出日志消息,看起来不不同于前面的教程。最重要的变化是,现在我们想发布消息日志交流而不是无名。这里是emit_log的代码emit_log.php脚本:

```php
<?php
require_once __DIR__ . '/vendor/autoload.php';
use PhpAmqpLib\Connection\AMQPStreamConnection;
use PhpAmqpLib\Message\AMQPMessage;

$connection = new AMQPStreamConnection('localhost', 5672, 'guest', 'guest');
$channel = $connection->channel();

$channel->exchange_declare('logs', 'fanout', false, false, false);

$data = implode(' ', array_slice($argv, 1));
if(empty($data)) $data = "info: Hello World!";
$msg = new AMQPMessage($data);

$channel->basic_publish($msg, 'logs');

echo " [x] Sent ", $data, "\n";

$channel->close();
$connection->close();

```

如你所见,建立连接后,我们宣布交换。这一步是必要的发布到一个不存在的交易是被禁止的。
信息将丢失如果没有队列绑定到交易所,但那是为我们好,如果没有消费者听我们可以安全地丢弃消息。
receive_logs.php的代码:

```php
<?php
require_once __DIR__ . '/vendor/autoload.php';
use PhpAmqpLib\Connection\AMQPStreamConnection;

$connection = new AMQPStreamConnection('localhost', 5672, 'guest', 'guest');
$channel = $connection->channel();

$channel->exchange_declare('logs', 'fanout', false, false, false);

list($queue_name, ,) = $channel->queue_declare("", false, false, true, false);

$channel->queue_bind($queue_name, 'logs');

echo ' [*] Waiting for logs. To exit press CTRL+C', "\n";

$callback = function($msg){
  echo ' [x] ', $msg->body, "\n";
};

$channel->basic_consume($queue_name, '', false, true, false, false, $callback);

while(count($channel->callbacks)) {
    $channel->wait();
}

$channel->close();
$connection->close();
```

如果你想将日志保存到一个文件,打开一个控制台和类型:

```php
php receive_logs.php > logs_from_rabbit.log
```

如果你想看到登录屏幕,产生一个新的终端并运行:

```php
php receive_logs.php
```

当然,发出日志类型:

```php
php emit_log.php
```

使用rabbitmqctl list_bindings实际上您可以验证代码创建绑定和队列,因为我们想要的。有两个receive_logs。您应当会看到类似运行php程序

```php
sudo rabbitmqctl list_bindings
```

结果的解释很简单:数据与服务器交换日志去两个队列的名称。而这正是我们的目的。